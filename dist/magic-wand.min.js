/*
 Magic wand tool (fuzzy selection) by color

 @package magic-wand-tool
 @author Ryasnoy Paul <ryasnoypaul@gmail.com>
 @version 1.1.4
 @license MIT
 @copyright (c) 2014-2020, Ryasnoy Paul <ryasnoypaul@gmail.com>

*/
/*
 Magic wand tool (fuzzy selection) by color

 @package magic-wand-tool
 @author Ryasnoy Paul <ryasnoypaul@gmail.com>
 @version 1.1.4
 @license MIT
 @copyright (c) 2014-2019, Ryasnoy Paul <ryasnoypaul@gmail.com>

*/
MagicWand=function(){var r={};function i(r,i,t,n){var a=Math.abs(r-t),o=Math.abs(i-n);return Math.sqrt(a*a+o*o)}return r.floodFill=function(r,t,n,a,o,f,h,s,e=20){return s?function(r,t,n,a,o,f,h,s){console.log("floodFillWithBordersssssssss",t,n,f);var e,l,u,d,y,g,x,m,b,p,w=r.data,c=r.width,v=r.height,M=r.bytes,k=-1,X=c+1,Y=-1,A=v+1,U=n*c+t,B=new Uint8Array(h||c*v),q=new Uint8Array(h||c*v);let F=!0;if(null!==a&&null!==o){console.log("extraaaaaaaaaa",a,o);for(var W=-s;W<=s;W++)for(var C=-s;C<=s;C++){if(!(o+C<0||o+C>=v||a+W<0||a+W>=c))if(!(i(a,o,a+W,o+C)>s))0===q[I=(o+C)*c+a+W]&&(B[I]=1,F=!1)}}else for(W=-s;W<=s;W++){for(C=-s;C<=s;C++){var I;if(!(n+C<0||n+C>=v||t+W<0||t+W>=c))if(!(i(t,n,t+W,n+C)>s))if(0===q[I=(n+C)*c+t+W]){F=!1;break}}if(!F)break}if(F)return null;var P=[w[U*=M],w[U+1],w[U+2],w[U+3]],O=[];for(W=-s;W<=s;W++)for(C=-s;C<=s;C++)n+C<0||n+C>=v||t+W<0||t+W>=c||i(t,n,t+W,n+C)>s||O.push({y:n+C,left:t+W-1,right:t+W+1,dir:1});console.log("stackkkkkk",O.length);do{for(d=O.shift(),p=!1,l=d.left+1;l<d.right;l++)if(x=d.y*c,U=(x+l)*M,1!==q[x+l]&&(p=!0,B[x+l]=1,q[x+l]=1,0!==w[U+3]&&!((e=w[U]-P[0])>f||e<-f||(e=w[U+1]-P[1])>f||e<-f||(e=w[U+2]-P[2])>f||e<-f))){for(g=l-1;g>-1&&(U=(m=x+g)*M,1!==q[m])&&(B[m]=1,q[m]=1,g--,0!==w[U+3])&&!((e=w[U]-P[0])>f||e<-f)&&!((e=w[U+1]-P[1])>f||e<-f)&&!((e=w[U+2]-P[2])>f||e<-f););for(y=l+1;y<c&&(U=(b=x+y)*M,1!==q[b])&&(B[b]=1,q[b]=1,y++,0!==w[U+3])&&!((e=w[U]-P[0])>f||e<-f)&&!((e=w[U+1]-P[1])>f||e<-f)&&!((e=w[U+2]-P[2])>f||e<-f););g<X&&(X=g+1),y>k&&(k=y-1),(u=d.y-d.dir)>=0&&u<v&&(g<d.left&&O.push({y:u,left:g,right:d.left,dir:-d.dir}),d.right<y&&O.push({y:u,left:d.right,right:y,dir:-d.dir})),(u=d.y+d.dir)>=0&&u<v&&g<y&&O.push({y:u,left:g,right:y,dir:d.dir})}p&&(d.y<A&&(A=d.y),d.y>Y&&(Y=d.y))}while(O.length>0);return{data:B,width:r.width,height:r.height,bounds:{minX:X,minY:A,maxX:k,maxY:Y}}}(r,t,n,a,o,f,h,e):function(r,i,t,n,a){var o,f,h,s,e,l,u,d,y,g,x=r.data,m=r.width,b=r.height,p=r.bytes,w=-1,c=m+1,v=-1,M=b+1,k=t*m+i,X=new Uint8Array(m*b),Y=new Uint8Array(a||m*b);if(1===Y[k])return null;var A=[x[k*=p],x[k+1],x[k+2],x[k+3]],U=[{y:t,left:i-1,right:i+1,dir:1}];do{for(s=U.shift(),g=!1,f=s.left+1;f<s.right;f++)if(u=s.y*m,k=(u+f)*p,1!==Y[u+f]&&!((o=x[k]-A[0])>n||o<-n||(o=x[k+1]-A[1])>n||o<-n||(o=x[k+2]-A[2])>n||o<-n)){for(g=!0,X[u+f]=1,Y[u+f]=1,l=f-1;l>-1&&(k=(d=u+l)*p,1!==Y[d])&&!((o=x[k]-A[0])>n||o<-n)&&!((o=x[k+1]-A[1])>n||o<-n)&&!((o=x[k+2]-A[2])>n||o<-n);)X[d]=1,Y[d]=1,l--;for(e=f+1;e<m&&(k=(y=u+e)*p,1!==Y[y])&&!((o=x[k]-A[0])>n||o<-n)&&!((o=x[k+1]-A[1])>n||o<-n)&&!((o=x[k+2]-A[2])>n||o<-n);)X[y]=1,Y[y]=1,e++;l<c&&(c=l+1),e>w&&(w=e-1),(h=s.y-s.dir)>=0&&h<b&&(l<s.left&&U.push({y:h,left:l,right:s.left,dir:-s.dir}),s.right<e&&U.push({y:h,left:s.right,right:e,dir:-s.dir})),(h=s.y+s.dir)>=0&&h<b&&l<e&&U.push({y:h,left:l,right:e,dir:s.dir})}g&&(s.y<M&&(M=s.y),s.y>v&&(v=s.y))}while(U.length>0);return{data:X,width:r.width,height:r.height,bounds:{minX:c,minY:M,maxX:w,maxY:v}}}(r,t,n,f,h)},r.backgroundFillWithBorders=function(r,t,n,a,o,f=20){console.log("backgroundFillWithBordersssss",t,n,a);var h,s,e,l,u,d,y,g,x,m,b=r.data,p=r.width,w=r.height,c=r.bytes,v=-1,M=p+1,k=-1,X=w+1,Y=n*p+t,A=new Uint8Array(o||p*w),U=new Uint8Array(o||p*w);console.log("iiiiiiiiiiiiiiii",Y,U[Y]);let B=!0;for(var q=-f;q<=f;q++){for(var F=-f;F<=f;F++){if(!(n+F<0||n+F>=w||t+q<0||t+q>=p))if(!(i(t,n,t+q,n+F)>f))if(1===U[(n+F)*p+t+q]){B=!1;break}}if(!B)break}if(B)return null;var W=[b[Y*=c],b[Y+1],b[Y+2],b[Y+3]],C=[];for(q=-f;q<=f;q++)for(F=-f;F<=f;F++)n+F<0||n+F>=w||t+q<0||t+q>=p||i(t,n,t+q,n+F)>f||C.push({y:n+F,left:t+q-1,right:t+q+1,dir:1});console.log("stackkkkkk",C.length);do{for(m=!1,s=(l=C.shift()).left+1;s<l.right;s++)if(Y=((y=l.y*p)+s)*c,0!==U[y+s]&&(m=!0,A[y+s]=0,U[y+s]=0,!((h=b[Y]-W[0])>a||h<-a||(h=b[Y+1]-W[1])>a||h<-a||(h=b[Y+2]-W[2])>a||h<-a))){for(d=s-1;d>-1&&(Y=(g=y+d)*c,0!==U[g])&&(A[g]=0,U[g]=0,d--,!((h=b[Y]-W[0])>a||h<-a))&&!((h=b[Y+1]-W[1])>a||h<-a)&&!((h=b[Y+2]-W[2])>a||h<-a););for(u=s+1;u<p&&(Y=(x=y+u)*c,0!==U[x])&&(A[x]=0,U[x]=0,u++,!((h=b[Y]-W[0])>a||h<-a))&&!((h=b[Y+1]-W[1])>a||h<-a)&&!((h=b[Y+2]-W[2])>a||h<-a););d<M&&(M=d+1),u>v&&(v=u-1),(e=l.y-l.dir)>=0&&e<w&&(d<l.left&&C.push({y:e,left:d,right:l.left,dir:-l.dir}),l.right<u&&C.push({y:e,left:l.right,right:u,dir:-l.dir})),(e=l.y+l.dir)>=0&&e<w&&d<u&&C.push({y:e,left:d,right:u,dir:l.dir})}m&&(l.y<X&&(X=l.y),l.y>k&&(k=l.y))}while(C.length>0);return{data:A,width:r.width,height:r.height,bounds:{minX:M,minY:X,maxX:v,maxY:k}}},r.gaussBlur=function(r,i){var t,n,a,o,f,h,s,e=2*i+1,l=i*i,u=new Float32Array(e),d=0,y=r.width,g=r.height,x=r.data,m=r.bounds.minX,b=r.bounds.maxX,p=r.bounds.minY,w=r.bounds.maxY;for(t=0;t<i;t++){var c=(i-t)*(i-t),v=Math.exp(-c/(2*l))/(2*Math.PI*l);u[i+t]=u[i-t]=v,d+=2*v}for(t=0;t<e;t++)u[t]/=d;var M=new Uint8Array(y*g),k=i+y,X=i+g;for(f=p;f<w+1;f++)for(o=m;o<b+1;o++){for(h=0,s=k-o<e?k-o:e,a=(n=f*y+o)-i,t=i-o>0?i-o:0;t<s;t++)h+=x[a+t]*u[t];for(s=X-f<e?X-f:e,a=n-i*y,t=i-f>0?i-f:0;t<s;t++)h+=x[a+t*y]*u[t];M[n]=h>.5?1:0}return{data:M,width:y,height:g,bounds:{minX:m,minY:p,maxX:b,maxY:w}}},r.gaussBlurOnlyBorder=function(r,i,t){var n,a,o,f,h,s,e,l,u,d,y=function(r,i,t){var n,a,o,f,h,s,e,l=r.width,u=r.height,d=r.data,y=new Uint8Array(d),g=r.bounds.minX,x=r.bounds.maxX,m=r.bounds.minY,b=r.bounds.maxY,p=l*u,w=new Uint8Array(p),c=[],v=Math.max(g,1),M=Math.min(x,l-2),k=Math.max(m,1),X=Math.min(b,u-2);if(t&&t.length>0)for(h=0;h<p;h++)1===t[h]&&(y[h]=1);for(f=k;f<X+1;f++)for(n=v;n<M+1;n++)0!==d[h=f*l+n]&&(s=h+l,e=h-l,0!==y[h+1]&&0!==y[h-1]&&0!==y[s]&&0!==y[s+1]&&0!==y[s-1]&&0!==y[e]&&0!==y[e+1]&&0!==y[e-1]||c.push(h));if(0==g)for(f=m;f<b+1;f++)1===d[f*l]&&c.push(f*l);if(x==l-1)for(f=m;f<b+1;f++)1===d[f*l+x]&&c.push(f*l+x);if(0==m)for(n=g;n<x+1;n++)1===d[n]&&c.push(n);if(b==u-1)for(n=g;n<x+1;n++)1===d[b*l+n]&&c.push(b*l+n);var Y,A=[],U=i+l,B=i+u,q=2*i+1;for(p=c.length,o=0;o<p;o++){for(w[h=c[o]]=1,A.push(h),f=(h-(n=h%l))/l,Y=U-n<q?U-n:q,s=h-i,a=i-n>0?i-n:0;a<Y;a++)0===w[e=s+a]&&(w[e]=1,A.push(e));for(Y=B-f<q?B-f:q,s=h-i*l,a=i-f>0?i-f:0;a<Y;a++)0===w[e=s+a*l]&&(w[e]=1,A.push(e))}return A}(r,i,t),g=2*i+1,x=2*i*i,m=new Float32Array(g),b=0,p=r.width,w=r.height,c=r.data,v=r.bounds.minX,M=r.bounds.maxX,k=r.bounds.minY,X=r.bounds.maxY,Y=y.length;for(o=0;o<i;o++)a=(i-o)*(i-o),n=Math.exp(-a/x)/Math.PI,m[i+o]=m[i-o]=n,b+=2*n;for(o=0;o<g;o++)m[o]/=b;var A=new Uint8Array(c),U=i+p,B=i+w;for(o=0;o<Y;o++){for(u=0,l=((h=y[o])-(e=h%p))/p,d=U-e<g?U-e:g,s=h-i,f=i-e>0?i-e:0;f<d;f++)u+=c[s+f]*m[f];if(u>.5)A[h]=1,e<v&&(v=e),e>M&&(M=e),l<k&&(k=l),l>X&&(X=l);else{for(d=B-l<g?B-l:g,s=h-i*p,f=i-l>0?i-l:0;f<d;f++)u+=c[s+f*p]*m[f];u>.5?(A[h]=1,e<v&&(v=e),e>M&&(M=e),l<k&&(k=l),l>X&&(X=l)):A[h]=0}}return{data:A,width:p,height:w,bounds:{minX:v,minY:k,maxX:M,maxY:X}}},r.createBorderMask=function(r){var i,t,n,a,o,f=r.width,h=r.height,s=r.data,e=r.bounds.minX,l=r.bounds.maxX,u=r.bounds.minY,d=r.bounds.maxY,y=l-e+1,g=d-u+1,x=new Uint8Array(y*g),m=Math.max(e,1),b=Math.min(l,f-2),p=Math.max(u,1),w=Math.min(d,h-2);for(t=p;t<w+1;t++)for(i=m;i<b+1;i++)0!==s[n=t*f+i]&&(a=n+f,o=n-f,0!==s[n+1]&&0!==s[n-1]&&0!==s[a]&&0!==s[a+1]&&0!==s[a-1]&&0!==s[o]&&0!==s[o+1]&&0!==s[o-1]||(x[(t-u)*y+(i-e)]=1));if(0==e)for(t=u;t<d+1;t++)1===s[t*f]&&(x[(t-u)*y]=1);if(l==f-1)for(t=u;t<d+1;t++)1===s[t*f+l]&&(x[(t-u)*y+(l-e)]=1);if(0==u)for(i=e;i<l+1;i++)1===s[i]&&(x[i-e]=1);if(d==h-1)for(i=e;i<l+1;i++)1===s[d*f+i]&&(x[(d-u)*y+(i-e)]=1);return{data:x,width:y,height:g,offset:{x:e,y:u}}},r.getBorderIndices=function(r,i=1){console.log("getBorderIndicessssssssss",i);var t,n,a,o,f,h,s=r.width,e=r.height,l=r.data,u=[],d=s-1,y=e-1,g=4,x=0;do{for(x+=1,g+=1,h=0,n=0;n<e;n++)for(t=0;t<s;t++)if(l[a=n*s+t]!==i){o=a+s,f=a-s;var m=0;m+=1*(l[a+1]===i),m+=1*(l[a-1]===i),m+=1*(l[o]===i),m+=1*(l[o+1]===i),m+=1*(l[o-1]===i),m+=1*(l[f]===i),m+=1*(l[f+1]===i),(m+=1*(l[f-1]===i))>=g&&(l[a]=i,h+=1)}}while(h>0&&x<=2);for(console.log("iterationssssssss",x),n=1;n<y;n++)for(t=1;t<d;t++)0!==l[a=n*s+t]&&(o=a+s,f=a-s,0!==l[a+1]&&0!==l[a-1]&&0!==l[o]&&0!==l[o+1]&&0!==l[o-1]&&0!==l[f]&&0!==l[f+1]&&0!==l[f-1]||u.push(a));for(n=0;n<e;n++)1===l[n*s]&&u.push(n*s);for(t=0;t<s;t++)1===l[t]&&u.push(t);for(a=s-1,n=0;n<e;n++)1===l[n*s+a]&&u.push(n*s+a);for(a=(e-1)*s,t=0;t<s;t++)1===l[a+t]&&u.push(a+t);return u},r.traceContours=function(r){var i,t,n,a,o,f,h,s,e,l,u,d,y,g,x,m=function(r){var i,t,n=r.width,a=r.data,o=r.bounds.minX,f=r.bounds.maxX,h=r.bounds.minY,s=r.bounds.maxY,e=f-o+3,l=s-h+3,u=new Uint8Array(e*l);for(t=h;t<s+1;t++)for(i=o;i<f+1;i++)1===a[t*n+i]&&(u[(t-h+1)*e+(i-o+1)]=1);return{data:u,width:e,height:l,offset:{x:o-1,y:h-1}}}(r),b=[],p=0,w=m.width,c=2*w,v=m.height,M=m.data,k=m.offset.x,X=m.offset.y,Y=new Uint8Array(M),A=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(a=1;a<v-1;a++)for(n=1;n<w-1;n++)if(1===M[o=a*w+n])for(i=-w;i<c;i+=c)if(0===M[o+i]&&0===Y[o+i]){for(p++,h=[],e=(s=i===w)?2:6,d=y=l={x:n,y:a},u=null;;){for(Y[d.y*w+d.x]=p,t=0;t<8;t++){if(x=A[e=(e+1)%8],1===M[f=(g={x:d.x+x[0],y:d.y+x[1]}).y*w+g.x]){Y[f]=p;break}Y[f]=-1,g=null}if(null===g)break;if(d=g,u){if(y.x===l.x&&y.y===l.y&&d.x===u.x&&d.y===u.y)break}else u=g;h.push({x:y.x+k,y:y.y+X}),y=d,e=(e+4)%8}null!=g&&(h.push({x:l.x+k,y:l.y+X}),b.push({inner:s,label:p,points:h}))}return b},r.simplifyContours=function(r,i,t){var n,a,o,f,h,s,e,l,u,d,y,g,x,m,b,p,w,c,v,M,k,X=r.length,Y=[];for(a=0;a<X;a++)if(h=(f=r[a]).points,(s=f.points.length)<t){for(e=[],o=0;o<s;o++)e.push({x:h[o].x,y:h[o].y});Y.push({inner:f.inner,label:f.label,points:e,initialCount:s})}else{l=[0,s-1],u=[{first:0,last:s-1}];do{if(!((d=u.shift()).last<=d.first+1)){for(y=-1,g=d.first,n=d.first+1;n<d.last;n++)v=h[n],M=h[d.first],k=h[d.last],w=v.x-M.x,c=v.y-M.y,m=Math.sqrt(w*w+c*c),w=v.x-k.x,c=v.y-k.y,b=Math.sqrt(w*w+c*c),w=M.x-k.x,c=M.y-k.y,p=Math.sqrt(w*w+c*c),(x=m>=Math.sqrt(b*b+p*p)?b:b>=Math.sqrt(m*m+p*p)?m:Math.abs((c*v.x-w*v.y+M.x*k.y-k.x*M.y)/p))>y&&(g=n,y=x);y>i&&(l.push(g),u.push({first:d.first,last:g}),u.push({first:g,last:d.last}))}}while(u.length>0);for(e=[],s=l.length,l.sort((function(r,i){return r-i})),o=0;o<s;o++)e.push({x:h[l[o]].x,y:h[l[o]].y});Y.push({inner:f.inner,label:f.label,points:e,initialCount:f.points.length})}return Y},r}(),module.exports=MagicWand;
//# sourceMappingURL=magic-wand.min.js.map
